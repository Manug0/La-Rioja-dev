pipeline {
    agent any
    environment {
        SFDX_AUTH_URL = credentials('SFDX_AUTH_URL_HSU')
        SFDX_ALIAS = 'hsu'
        PACKAGE_DIR = 'force-app'
        SF_DISABLE_TELEMETRY = "true"
        SF_CMD = 'C:\\Users\\Manu\\AppData\\Local\\sf\\client\\2.92.7-df40848\\bin\\sf.cmd'
    }
    stages {
        stage('Checkout') { steps { checkout scm } }
        stage('Verificar SFDX') { steps { bat "${SF_CMD} --version" } }
        stage('Authenticate') {
            steps {
                bat 'echo %SFDX_AUTH_URL% > auth_url.txt'
                bat "${SF_CMD} org login sfdx-url --sfdx-url-file auth_url.txt --alias %SFDX_ALIAS%"
            }
        }
        stage('Validar código') {
            steps {
                bat "${SF_CMD} project deploy validate --source-dir force-app/main/default/objects --source-dir force-app/main/default/classes --target-org %SFDX_ALIAS% --test-level RunSpecifiedTests --tests HSU_SistemasUpdater_TEST,HSU_UTSUpdater_TEST"
            }
        }
    }
    post {
        success { echo "Validación completada con éxito." }
        failure { echo "Errores en la validación. Revisa el log de Jenkins." }
    }
}
// This Jenkinsfile is designed to validate code in a Salesforce